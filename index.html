<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encore Landscape - Captive Insurance Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <script>
        // Verify Chart.js is loaded
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js failed to load from CDN!');
                alert('Chart.js failed to load. Please check your internet connection.');
            } else {
                console.log('Chart.js loaded successfully, version:', Chart.version);
            }
        });
    </script>
</head>
<body>
    <div class="header">
    <h1><b>Encore Landscape Management</b></h1>
    <div class="subtitle">REvolution Insurance, LTD. - Member 800017 Dashboard</div>
    <div style="font-size: 1rem; margin-top: 0.5rem; opacity: 0.95;">Board of Directors Meeting - June 24-28 at the Fairmont Chateau Whistler, BC, Canada</div>
    <div style="margin-top: 1.5rem;">
        <button class="logistics-button" onclick="loadSection('travel-info')">‚úàÔ∏è Travel Info</button>
        <button class="logistics-button" onclick="loadSection('board-meeting')">üìã Board Meeting</button>
    </div>
</div>

<!-- Main Navigation -->
<nav class="main-nav">
    <div class="nav-container">
        <button class="nav-button active" onclick="loadSection('captive-info')">What is a Captive</button>
        <button class="nav-button" onclick="loadSection('financial-info')">Financial Info</button>
        <button class="nav-button" onclick="loadSection('renewal-info')">Renewal Info</button>
        <button class="nav-button" onclick="loadSection('renewal-book-summary')">Renewal Book</button>
    </div>
</nav>
    
    <div class="main-content">
        <div id="content-area">
            <!-- Dynamic content will be loaded here -->
        </div>
    </div>
    
    <script src="js/navigation.js"></script>
    
    <!-- Inline Charts Code -->
    <script>
    // js/charts.js content inline
    let chartsInitialized = false;
    let chartInstances = {};

    function initializeCharts() {
        console.log('Initializing charts...');
        
        // Reset if already initialized
        if (chartsInitialized) {
            console.log('Charts already initialized, destroying first...');
            destroyCharts();
        }
        
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            console.error('Chart.js is not loaded!');
            return;
        }
        
        // Chart.js configuration
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
        
        // Wait a bit more to ensure DOM is ready
        setTimeout(() => {
            // Initialize trend chart
            const trendCanvas = document.getElementById('trendChart');
            console.log('Trend canvas:', trendCanvas);
            
            if (trendCanvas) {
                try {
                    const trendCtx = trendCanvas.getContext('2d');
                    chartInstances.trendChart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jul 2024', 'Aug 2024', 'Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025', 'Mar 2025', 'Apr 2025'],
                            datasets: [
                                {
                                    label: 'Total Incurred',
                                    data: [0, 0, 0, 7693, 13693, 13693, 13693, 13693, 16683, 39681],
                                    borderColor: '#3498db',
                                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 3
                                },
                                {
                                    label: 'WC Claims',
                                    data: [0, 0, 0, 0, 5500, 5500, 5500, 5500, 5500, 5500],
                                    borderColor: '#2ecc71',
                                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: 'AL Claims',
                                    data: [0, 0, 0, 0, 8193, 8193, 8193, 8193, 11183, 26488],
                                    borderColor: '#e74c3c',
                                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2
                                },
                                {
                                    label: 'APD Claims',
                                    data: [0, 0, 0, 7693, 0, 0, 0, 0, 0, 7693],
                                    borderColor: '#f39c12',
                                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log('Trend chart created successfully');
                } catch (error) {
                    console.error('Error creating trend chart:', error);
                }
            }
            
            // Initialize coverage chart
            const coverageCanvas = document.getElementById('coverageChart');
            console.log('Coverage canvas:', coverageCanvas);
            
            if (coverageCanvas) {
                try {
                    const coverageCtx = coverageCanvas.getContext('2d');
                    chartInstances.coverageChart = new Chart(coverageCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Workers Compensation', 'Auto Liability', 'General Liability', 'Auto Physical Damage'],
                            datasets: [{
                                data: [251438, 248864, 55670, 147432],
                                backgroundColor: [
                                    '#3498db',
                                    '#e74c3c',
                                    '#2ecc71',
                                    '#f39c12'
                                ],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = '$' + context.parsed.toLocaleString();
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                                            return label + ': ' + value + ' (' + percentage + '%)';
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log('Coverage chart created successfully');
                } catch (error) {
                    console.error('Error creating coverage chart:', error);
                }
            }
            
            // Initialize development chart
            const developmentCanvas = document.getElementById('developmentChart');
            console.log('Development canvas:', developmentCanvas);
            
            if (developmentCanvas) {
                try {
                    const developmentCtx = developmentCanvas.getContext('2d');
                    chartInstances.developmentChart = new Chart(developmentCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Paid', 'Reserves', 'Expense Paid', 'Expense Reserve'],
                            datasets: [
                                {
                                    label: 'Workers Comp',
                                    data: [4947, 53, 65, 435],
                                    backgroundColor: '#3498db'
                                },
                                {
                                    label: 'Auto Liability',
                                    data: [12933, 12840, 65, 650],
                                    backgroundColor: '#e74c3c'
                                },
                                {
                                    label: 'General Liability',
                                    data: [0, 0, 0, 0],
                                    backgroundColor: '#2ecc71'
                                },
                                {
                                    label: 'Auto Physical Damage',
                                    data: [7693, 0, 0, 0],
                                    backgroundColor: '#f39c12'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return '$' + value.toLocaleString();
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log('Development chart created successfully');
                } catch (error) {
                    console.error('Error creating development chart:', error);
                }
            }
            
            chartsInitialized = true;
            console.log('All charts initialized');
            
        }, 500); // Increased delay to ensure DOM is ready
    }

    // Function to destroy all charts (useful when navigating away)
    function destroyCharts() {
        console.log('Destroying charts...');
        Object.keys(chartInstances).forEach(key => {
            if (chartInstances[key]) {
                try {
                    chartInstances[key].destroy();
                    delete chartInstances[key];
                } catch (error) {
                    console.error('Error destroying chart:', key, error);
                }
            }
        });
        chartsInitialized = false;
    }

    // Force re-initialization function for debugging
    function forceInitCharts() {
        console.log('Force initializing charts...');
        destroyCharts();
        setTimeout(() => {
            initializeCharts();
        }, 100);
    }
    </script>
    
    <script>
        // Load the first section on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSection('captive-info');
        });
        
        // Add manual chart initialization for debugging
        function debugCharts() {
            console.log('=== Chart Debug Info ===');
            console.log('Chart.js loaded:', typeof Chart !== 'undefined');
            console.log('initializeCharts available:', typeof initializeCharts !== 'undefined');
            console.log('Current section:', window.currentSection);
            console.log('Canvas elements found:');
            console.log('- trendChart:', document.getElementById('trendChart'));
            console.log('- coverageChart:', document.getElementById('coverageChart'));
            console.log('- developmentChart:', document.getElementById('developmentChart'));
            console.log('=======================');
            
            if (window.currentSection === 'financial-info' && typeof forceInitCharts === 'function') {
                console.log('Forcing chart initialization...');
                forceInitCharts();
            }
        }
        
        // KPI Modal Functions
        function showKPIDetail(type) {
            console.log('showKPIDetail called for:', type);
            const modal = document.getElementById('kpi-modal');
            const modalBody = document.getElementById('kpi-modal-body');
            
            if (!modal || !modalBody) {
                console.error('KPI modal elements not found');
                return;
            }
            
            let content = '';
            
            switch(type) {
                case 'equity':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Total Equity Calculation</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">$371,314 Before IBNR</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Components of Your Equity:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">A Fund Balance</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$106,030</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">B Fund Balance</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$46,361</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Capital Contribution</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$80,000</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Letter of Credit</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$100,000</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Investment Income</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$6,196</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Retained Earnings</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$32,727</td>
                                    </tr>
                                    <tr style="background: #e3f2fd;">
                                        <td style="padding: 0.8rem; font-weight: 700;">Total Equity Before IBNR</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 700; color: #2196f3;">$371,314</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                                <strong>Important Note:</strong> This is equity "before IBNR." IBNR (Incurred But Not Reported) reserves are calculated at the captive level and will reduce distributable equity. These reserves protect against claims that have occurred but haven't been reported yet.
                            </div>
                            
                            <div style="margin-top: 1rem; padding: 1rem; background: #d4edda; border-radius: 6px;">
                                <strong>How Your Equity Grew:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>Premium paid: $595,402</li>
                                    <li>Less claims paid: -$30,557</li>
                                    <li>Less operating costs: -$119,980</li>
                                    <li>Plus investment income: +$6,196</li>
                                    <li>Plus prior retained earnings: +$32,727</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'premium':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Premium Breakdown</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Annual Premium: $595,402</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Monthly Calculation:</h4>
                                <div style="font-size: 1.2rem; font-weight: 600; text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                    $595,402 √∑ 12 months = $49,617/month
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Premium Components:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">A Fund (First $100k layer)</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$137,560</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">B Fund ($100k-$400k layer)</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$47,800</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Operating Costs</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600;">$410,042</td>
                                    </tr>
                                    <tr style="background: #e3f2fd;">
                                        <td style="padding: 0.8rem; font-weight: 700;">Total Annual Premium</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 700; color: #2196f3;">$595,402</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div style="background: #e8f4fd; padding: 1rem; border-radius: 6px;">
                                <strong>Premium by Coverage Type:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>Workers Compensation: $251,438</li>
                                    <li>Auto Liability: $248,864</li>
                                    <li>General Liability: $55,670</li>
                                    <li>Auto Physical Damage: $147,432</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'lossratio':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Loss Ratio Calculation</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Current Loss Ratio: 18.0%</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">The Formula:</h4>
                                <div style="font-size: 1.1rem; text-align: center; padding: 1.5rem; background: white; border-radius: 6px;">
                                    <div style="margin-bottom: 1rem;">
                                        Loss Ratio = (Total Incurred Losses √∑ Earned Premium) √ó 100
                                    </div>
                                    <div style="font-weight: 700; color: #2196f3; font-size: 1.3rem;">
                                        ($39,681 √∑ $220,441) √ó 100 = 18.0%
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Breakdown of Losses:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr style="background: #e9ecef;">
                                        <th style="padding: 0.8rem; text-align: left;">Component</th>
                                        <th style="padding: 0.8rem; text-align: right;">Amount</th>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Claims Paid</td>
                                        <td style="text-align: right; padding: 0.8rem;">$25,703</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Claims Reserves</td>
                                        <td style="text-align: right; padding: 0.8rem;">$13,978</td>
                                    </tr>
                                    <tr style="background: #e3f2fd;">
                                        <td style="padding: 0.8rem; font-weight: 700;">Total Incurred</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 700;">$39,681</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                                <strong>Why Use Earned Premium?</strong>
                                <p style="margin-top: 0.5rem;">Earned premium ($220,441) represents 9 months of your 12-month policy. This gives the most accurate loss ratio because it matches losses to the coverage period.</p>
                                <p style="margin-top: 0.5rem;">Annual premium: $595,402<br>
                                Monthly: $49,617<br>
                                9 months earned: $49,617 √ó 9 = $446,553 √ó factor = $220,441</p>
                            </div>
                            
                            <div style="background: #e8f4fd; padding: 1rem; border-radius: 6px;">
                                <strong>Performance Benchmark:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>Your Loss Ratio: 18.0% ‚úÖ</li>
                                    <li>Target: Below 60%</li>
                                    <li>Industry Average: 65-75%</li>
                                </ul>
                                <p style="margin-top: 0.5rem; color: #27ae60;"><strong>Excellent performance!</strong> You're well below target.</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'claims':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Claims Detail - YTD 2024/25</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Total Claims: 8</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Claims by Coverage Type:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #e9ecef;">
                                            <th style="padding: 0.8rem; text-align: left;">Coverage</th>
                                            <th style="padding: 0.8rem; text-align: center;">Count</th>
                                            <th style="padding: 0.8rem; text-align: right;">Total Incurred</th>
                                            <th style="padding: 0.8rem; text-align: right;">Average</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Workers Comp (WC)</td>
                                            <td style="text-align: center; padding: 0.8rem;">3</td>
                                            <td style="text-align: right; padding: 0.8rem;">$5,500</td>
                                            <td style="text-align: right; padding: 0.8rem;">$1,833</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Auto Liability (AL)</td>
                                            <td style="text-align: center; padding: 0.8rem;">4</td>
                                            <td style="text-align: right; padding: 0.8rem;">$26,488</td>
                                            <td style="text-align: right; padding: 0.8rem;">$6,622</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">General Liability (GL)</td>
                                            <td style="text-align: center; padding: 0.8rem;">0</td>
                                            <td style="text-align: right; padding: 0.8rem;">$0</td>
                                            <td style="text-align: right; padding: 0.8rem;">$0</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Auto Physical Damage (APD)</td>
                                            <td style="text-align: center; padding: 0.8rem;">1</td>
                                            <td style="text-align: right; padding: 0.8rem;">$7,693</td>
                                            <td style="text-align: right; padding: 0.8rem;">$7,693</td>
                                        </tr>
                                        <tr style="background: #e3f2fd;">
                                            <td style="padding: 0.8rem; font-weight: 700;">TOTAL</td>
                                            <td style="text-align: center; padding: 0.8rem; font-weight: 700;">8</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">$39,681</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">$4,960</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                                <strong>Claims Timeline:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>October 2024: 1 APD claim ($7,693)</li>
                                    <li>November 2024: 2 claims (WC + AL)</li>
                                    <li>March 2025: 1 AL claim</li>
                                    <li>April 2025: 4 claims (1 WC + 3 AL)</li>
                                </ul>
                            </div>
                            
                            <div style="background: #f8d7da; padding: 1rem; border-radius: 6px;">
                                <strong>‚ö†Ô∏è Alert: Auto Liability Trending Up</strong>
                                <p style="margin-top: 0.5rem;">You've had 4 AL claims total, with 3 occurring in April 2025. Consider implementing additional driver safety training and vehicle maintenance programs.</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                // Renewal-specific KPIs
                case 'renewal-premium':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Renewal Premium Breakdown</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Annual Renewal Premium: $703,404</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Component Comparison:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #e9ecef;">
                                            <th style="padding: 0.8rem; text-align: left;">Component</th>
                                            <th style="padding: 0.8rem; text-align: right;">Current</th>
                                            <th style="padding: 0.8rem; text-align: right;">Renewal</th>
                                            <th style="padding: 0.8rem; text-align: right;">Change</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">A Fund</td>
                                            <td style="text-align: right; padding: 0.8rem;">$137,560</td>
                                            <td style="text-align: right; padding: 0.8rem;">$239,350</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #e74c3c;">+$101,790</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">B Fund</td>
                                            <td style="text-align: right; padding: 0.8rem;">$47,800</td>
                                            <td style="text-align: right; padding: 0.8rem;">$184,854</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #e74c3c;">+$137,054</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Operating Costs</td>
                                            <td style="text-align: right; padding: 0.8rem;">$410,042</td>
                                            <td style="text-align: right; padding: 0.8rem;">$279,200</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #27ae60;">-$130,842</td>
                                        </tr>
                                        <tr style="background: #e3f2fd;">
                                            <td style="padding: 0.8rem; font-weight: 700;">Total Premium</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">$595,402</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">$703,404</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700; color: #e74c3c;">+$108,002</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px;">
                                <strong>Key Changes:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>Loss funds increased 129% to reflect adjusted risk</li>
                                    <li>Operating costs decreased 32% due to efficiencies</li>
                                    <li>Overall increase of 18.1% from current year</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'premium-increase':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Premium Increase Analysis</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Total Increase: +18.1% ($108,002)</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">What's Driving Your Increase:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #e9ecef;">
                                            <th style="padding: 0.8rem; text-align: left;">Factor</th>
                                            <th style="padding: 0.8rem; text-align: right;">Dollar Impact</th>
                                            <th style="padding: 0.8rem; text-align: right;">% of Premium</th>
                                            <th style="padding: 0.8rem; text-align: right;">% of Increase</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Your Business Growth</td>
                                            <td style="text-align: right; padding: 0.8rem;">$29,770</td>
                                            <td style="text-align: right; padding: 0.8rem;">5.0%</td>
                                            <td style="text-align: right; padding: 0.8rem;">27.6%</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Inflation Adjustment</td>
                                            <td style="text-align: right; padding: 0.8rem;">$11,908</td>
                                            <td style="text-align: right; padding: 0.8rem;">2.0%</td>
                                            <td style="text-align: right; padding: 0.8rem;">11.0%</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Reinsurance Rate Increase</td>
                                            <td style="text-align: right; padding: 0.8rem;">$17,862</td>
                                            <td style="text-align: right; padding: 0.8rem;">3.0%</td>
                                            <td style="text-align: right; padding: 0.8rem;">16.5%</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">Loss Fund & Other</td>
                                            <td style="text-align: right; padding: 0.8rem;">$48,462</td>
                                            <td style="text-align: right; padding: 0.8rem;">8.1%</td>
                                            <td style="text-align: right; padding: 0.8rem;">44.9%</td>
                                        </tr>
                                        <tr style="background: #e3f2fd;">
                                            <td style="padding: 0.8rem; font-weight: 700;">Total Increase</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">$108,002</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">18.1%</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700;">100.0%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                                <strong>Key Insights:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li><strong>39% of increase</strong> is from your business growth and inflation (within your control)</li>
                                    <li><strong>61% of increase</strong> is from external factors (market conditions)</li>
                                    <li>Your excellent 18% loss ratio helps keep the increase moderate</li>
                                </ul>
                            </div>
                            
                            <div style="background: #d4edda; padding: 1rem; border-radius: 6px;">
                                <strong>Your Performance Impact:</strong>
                                <p style="margin-top: 0.5rem;">With an 18% loss ratio (vs 60% target), you're positioned for potential profit sharing that could offset some of this increase through equity growth.</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'monthly-renewal':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Monthly Premium Calculation</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Monthly Premium: $58,617</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Calculation:</h4>
                                <div style="font-size: 1.2rem; text-align: center; padding: 1.5rem; background: white; border-radius: 6px;">
                                    <div style="margin-bottom: 1rem;">
                                        Annual Premium √∑ 12 Months = Monthly Premium
                                    </div>
                                    <div style="font-weight: 700; color: #2196f3; font-size: 1.3rem;">
                                        $703,404 √∑ 12 = $58,617
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Monthly Comparison:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Current Monthly</td>
                                        <td style="text-align: right; padding: 0.8rem;">$49,617</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 0.8rem;">Renewal Monthly</td>
                                        <td style="text-align: right; padding: 0.8rem;">$58,617</td>
                                    </tr>
                                    <tr style="background: #fff3cd;">
                                        <td style="padding: 0.8rem; font-weight: 600;">Monthly Increase</td>
                                        <td style="text-align: right; padding: 0.8rem; font-weight: 600; color: #e74c3c;">+$9,000</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div style="background: #e8f4fd; padding: 1rem; border-radius: 6px;">
                                <strong>Budget Planning:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>Additional monthly cost: $9,000</li>
                                    <li>Daily cost increase: $300</li>
                                    <li>Consider this represents comprehensive coverage for your growing operation</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'business-growth':
                    content = `
                        <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Business Growth Analysis</h2>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">Your Business Growth: 5.0%</h3>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Exposure Changes by Coverage:</h4>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #e9ecef;">
                                            <th style="padding: 0.8rem; text-align: left;">Coverage Type</th>
                                            <th style="padding: 0.8rem; text-align: right;">Current</th>
                                            <th style="padding: 0.8rem; text-align: right;">Renewal</th>
                                            <th style="padding: 0.8rem; text-align: right;">Growth %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">WC Payroll</td>
                                            <td style="text-align: right; padding: 0.8rem;">$9.28M</td>
                                            <td style="text-align: right; padding: 0.8rem;">$9.48M</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #27ae60;">+2.2%</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">GL Payroll</td>
                                            <td style="text-align: right; padding: 0.8rem;">$6.05M</td>
                                            <td style="text-align: right; padding: 0.8rem;">$6.25M</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #27ae60;">+3.3%</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">AL Units</td>
                                            <td style="text-align: right; padding: 0.8rem;">105</td>
                                            <td style="text-align: right; padding: 0.8rem;">113</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #27ae60;">+7.6%</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 0.8rem;">APD Units</td>
                                            <td style="text-align: right; padding: 0.8rem;">152</td>
                                            <td style="text-align: right; padding: 0.8rem;">162</td>
                                            <td style="text-align: right; padding: 0.8rem; color: #27ae60;">+6.6%</td>
                                        </tr>
                                        <tr style="background: #e3f2fd;">
                                            <td style="padding: 0.8rem; font-weight: 700;">Weighted Average</td>
                                            <td style="text-align: right; padding: 0.8rem;" colspan="2">-</td>
                                            <td style="text-align: right; padding: 0.8rem; font-weight: 700; color: #2196f3;">5.0%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                                <strong>Growth Indicators:</strong>
                                <ul style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                                    <li>Added 8 vehicles to your fleet (7.6% growth)</li>
                                    <li>Increased payroll by $400K (healthy expansion)</li>
                                    <li>10 additional units for physical damage coverage</li>
                                </ul>
                            </div>
                            
                            <div style="background: #e8f4fd; padding: 1rem; border-radius: 6px;">
                                <strong>Premium Impact:</strong>
                                <p style="margin-top: 0.5rem;">Your 5% business growth accounts for $29,770 of the premium increase. This is a normal and expected increase as your business expands - more employees, vehicles, and operations require proportionally more coverage.</p>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }
        
        function closeKPIModal() {
            const modal = document.getElementById('kpi-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Close modal when clicking outside of it
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('kpi-modal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    </script>
</body>
</html>